# Version History

## Version 0.3.0 (Current - 2025-11-19)
- **Phase 5 Complete - Advanced Graphics & Transparency**
- **Premium Modules Architecture** âœ… **NEW**
  - Introduced modular premium feature system with Boolean flags
  - Module flags in VNSPDFModule: kHasEncryptionModule, kHasPDFAModule, kHasZlibModule, kHasTableModule
  - Premium modules folder: PDF_Library/Premium/
  - Conditional compilation gating for premium features
  - Clear error messages when premium features accessed without modules
  - Segregated FREE vs PREMIUM feature sets
  - See [Chapter 16: Premium Modules](16-premium-modules.md) for details
- **VNSPDFEncryptionPremium** âœ… **NEW - PARTIAL**
  - RC4-128 (128-bit encryption, Revision 3) - **FULLY WORKING**
  - 50-iteration MD5 key derivation for enhanced security
  - AES-128/256 method stubs ready (Revisions 4-6) - needs pure Xojo implementation
  - Module flag: kHasEncryptionModule (default: False)
  - Estimated AES implementation: 12-14 hours
- **VNSPDFPDFAPremium** âœ… **NEW - COMPLETE**
  - Output Intent support for PDF/A archival compliance
  - ICC color profile embedding
  - Automatic sRGB profile detection on macOS
  - Module flag: kHasPDFAModule (default: False)
  - AddOutputIntent() method with gkOutputIntentPDFA1 constant
  - Example 13 demonstrates PDF/A output intent with color profiles
- **VNSPDFZlibPremium** ðŸ”¨ **NEW - PLACEHOLDER**
  - Structure ready for pure Xojo zlib implementation
  - iOS compression support (sandboxing blocks native zlib)
  - Module flag: kHasZlibModule (default: False)
  - Estimated implementation: 33-42 hours (DEFLATE algorithm)
- **VNSPDFTablePremium** ðŸ”¨ **NEW - PLACEHOLDER**
  - Structure ready for high-level table API
  - Auto column sizing, header styling, alternating rows
  - Module flag: kHasTableModule (default: False)
  - Estimated implementation: 30-37 hours
- **Documentation**
  - NEW: Chapter 16 - Premium Modules (comprehensive)
  - Updated: Architecture overview with FREE/PREMIUM comparison
  - Updated: Modules chapter with premium module section
  - Updated: Future enhancements with premium roadmap
  - NEW: FEATURE_COMPARISON_FREE.md (208 features analyzed)
  - NEW: FEATURE_COMPARISON_PREMIUM.md (240 features analyzed)
- **PDF Encryption & Security (RC4-128)** âœ… **NEW**
  - VNSPDFEncryption class (563 lines) with Revisions 2-6 support
  - SetProtection() - User/owner passwords and permission restrictions
  - SetEncryption() - Advanced encryption configuration
  - SecurityDialog - Interactive encryption settings UI
  - Example 14 - Security demonstration with password/permission testing
  - **Working**: Revision 3 (RC4-128) - Production-ready
  - **Known Limitation**: AES encryption (Revisions 4-6) blocked by Xojo Crypto API PKCS7 padding issue
  - Object-level encryption with unique keys per PDF object
  - Proper encryption/compression order (compress first, then encrypt)
  - Binary string handling with ChrB() and DefineEncoding(ASCII)
  - Fixed timing: encryption keys generated BEFORE page output
  - Comprehensive security comparison in FEATURE_COMPARISON.md
- **Font and Text Methods**
  - SetFontSize() - Change font size without changing family/style
  - SetFontStyle() - Change font style without changing family/size
  - SetWordSpacing() / GetWordSpacing() - Adjust spacing between words
  - SetUnderlineThickness() / GetUnderlineThickness() - Control underline thickness
  - SetTextRenderingMode() - 8 rendering modes (fill, stroke, invisible, clip)
  - WriteLinkString() - Write text with clickable URL link
  - WriteLinkID() - Write text with internal link ID
  - WriteAligned() - Write with left/center/right alignment
  - SplitLines() - Split text into lines that fit width
- **Page Navigation**
  - SetPage() - Navigate to existing pages for adding content
  - PageNo() - Get current page number
  - PageCount() - Get total number of pages
  - Useful for adding page numbers, headers, footers after creating all pages
- **Rounded Rectangles**
  - RoundedRect() - Selective corner rounding with "1234" string
  - RoundedRectExt() - Individual radius per corner
  - Bezier curve approximation for smooth corners
- **Elliptical Arcs**
  - Arc() - Elliptical arcs with rotation support
  - Automatic segmentation for smooth curves
  - Support for circular and elliptical arcs
  - Fill and stroke modes
- **Line Styles**
  - SetLineCapStyle() - butt, round, square
  - SetLineJoinStyle() - miter, round, bevel
  - SetDashPattern() - Custom dash patterns with phase offset
  - Professional line rendering
- **Alpha Transparency & Blend Modes**
  - SetAlpha() - Set transparency level (0.0-1.0)
  - GetAlpha() - Get current transparency
  - GetBlendMode() - Get current blend mode
  - 16 blend modes supported (Normal, Multiply, Screen, Overlay, Darken, Lighten, ColorDodge, ColorBurn, HardLight, SoftLight, Difference, Exclusion, Hue, Saturation, Color, Luminosity)
  - VNSPDFBlendMode class for graphics state management
  - Automatic PDF 1.4+ version upgrade when transparency used
- **Gradients (PDF Shading Patterns)**
  - LinearGradient() - Linear color transitions with normalized coordinates
  - RadialGradient() - Radial color transitions with dual-circle patterns
  - VNSPDFGradient class for gradient data storage
  - PDF Type 2 (linear) and Type 3 (radial) shading patterns
  - Normalized coordinate system (0.0 to 1.0)
  - Color interpolation functions in PDF
  - PutGradients() for shading pattern output
- **Clipping Paths**
  - ClipRect() - Rectangular clipping with optional outline
  - ClipCircle() - Circular clipping
  - ClipEllipse() - Elliptical clipping with Bezier approximation
  - ClipText() - Text-shaped clipping paths
  - ClipRoundedRect() - Rounded rectangle clipping with selective corners
  - ClipPolygon() - Multi-point polygon clipping with Pair arrays
  - ClipEnd() - Graphics state restoration with nesting support
  - Graphics state stack management (q/Q operators)
  - Clipping nest counter (mClipNest) for nested clipping support
- **Utility Methods & JSON Serialization** âœ… **NEW**
  - GetVersionString() - Returns "VNS PDF " + version number (e.g., "VNS PDF 0.3.0")
  - GetConversionRatio() - Returns scale factor from user units to points
    - For mm: 2.8346, for cm: 28.346, for inches: 72.0, for points: 1.0
  - GetPageSizeStr() - Parses page size strings ("A4", "Letter", "A5", "A3", "Legal")
    - Returns Pair(width, height) in current document units
    - Returns Nil for invalid size strings
    - Case-insensitive parsing
  - RawWriteStr() - Writes raw PDF commands directly to current page buffer
    - Enables advanced PDF operations not covered by standard API
    - PDF coordinates: Y measured from bottom in points
    - Example operators: m (move), l (line), S (stroke), RG (stroke color), w (width), q/Q (save/restore state)
  - Close() - Validates document state before completion
    - Checks for unclosed clipping operations (mClipNest must be 0)
    - Called automatically by Output() and SaveToFile()
    - Creates first page if document is empty
  - ToJSON() - Serializes document state to JSON string
    - Optional prettyPrint parameter for formatted output
    - Includes: metadata, page configuration, current position, colors, fonts
    - Does NOT include: page content, embedded images, binary data
    - Use cases: template systems, state persistence
  - FromJSON() - Deserializes document state from JSON string
    - Restores metadata, page dimensions, colors, positions
    - Font objects and images must be re-added separately
    - Error handling: SetError() called on parse failure
  - Example 17 - Comprehensive utility methods demonstration
- **Bug Fixes**
  - Fixed blend mode object number assignment (critical fix)
  - Fixed line join demonstration (use connected paths)
  - Fixed Arc() compilation errors (Pi constant, Integer conversion)
  - **Fixed gradient rendering (critical fix)** - Object number references were off by one after NewObj() increment (lines 3800, 3822). LinearGradient() and RadialGradient() now render correctly in all PDF viewers
- **Examples**
  - Extended Example 1 with rounded rectangles and transparency (2 pages), gradients and clipping (3 pages total)
  - Extended Example 3 with rounded rectangles page and arcs page (5 pages), gradients with clipping (6 pages total)
  - Extended Example 4 with line styles (2 pages), gradients with line styles (3 pages total)
  - Extended Example 11 with page navigation demonstration and explanations
  - Example 17 - Utility Methods and JSON Serialization (NEW)
    - GetVersionString() demonstration with version display
    - GetConversionRatio() with scale factor calculations
    - GetPageSizeStr() showing A4, Letter, and A5 dimensions
    - RawWriteStr() drawing red line with raw PDF operators (q, RG, w, m, l, S, Q)
    - ToJSON() serialization with JSON excerpt display
    - JSON state file export to Desktop
    - Close() validation documentation
    - Comprehensive demonstration of all 7 utility methods

## Version 0.2.0 (2025-01-15)
- Text rendering (Cell, MultiCell, Write, Text methods)
- Core PDF fonts with styles (Bold, Italic)
- Graphics primitives (Line, Rect, Circle, Ellipse)
- Colors (RGB for text, fill, and draw)
- Line width and styles
- PDF output generation (SaveToFile, GetBytes)
- Fixed text positioning in cells
- Fixed fill color command ordering
- Automatic text truncation with ellipsis
- Font selection inside PDF text objects
- Fixed fill color rendering for graphics primitives (Rect, Circle)
- Shared examples module across all platforms (Desktop, Web, iOS, Console)
- **Image support (JPEG and PNG)**
  - VNSPDFImage class for image parsing
  - Image() method for embedding images
  - RegisterImage() method for image optimization
  - Auto-dimension calculation with aspect ratio preservation
  - Support for RGB, Grayscale, CMYK color spaces
  - PNG alpha channel and indexed color support
  - PDF structure matches go-fpdf exactly (forced object numbering)
- **Document Metadata**
  - SetTitle, SetAuthor, SetSubject, SetKeywords, SetCreator, SetLang
  - UTF-16BE encoding for Unicode metadata
- **TrueType Font Support**
  - AddUTF8Font() for loading TrueType fonts
  - Full Unicode support with proper glyph spacing
  - Identity-H encoding, glyph ID mapping
  - Comprehensive character support (CJK, Cyrillic, RTL, symbols, currencies)
- **Stream Compression**
  - SetCompression(), GetCompression()
  - FlateDecode/zlib compression (27-60% file size reduction)
  - VNSZlibModule wrapper
- **Header/Footer Callbacks**
  - SetHeaderFunc(), SetFooterFunc()
  - VNSPDFModule.HeaderFooterDelegate pattern
  - Automatic invocation on every page
  - FontFamily(), FontStyle(), FontSizePt() helper methods
- **Links and Bookmarks**
  - AddLink(), SetLink(), Link() - Internal links
  - LinkString() - External URLs
  - Bookmark() - Hierarchical outline/sidebar navigation

## Version 0.1.0 (2025-01-13)
- Initial document structure
- Page management
- Unit conversion system
- Multiple page formats and orientations
- Error accumulation pattern
